Code developed by Ruijin Xie
